name: üöÄ Deploy website on push

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1Ô∏è‚É£ –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥
      - name: üöö Checkout code
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Node.js
      - name: Use Node.js 22
        uses: actions/setup-node@v3
        with:
          node-version: '22'

      # 3Ô∏è‚É£ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
      - name: üî® Build project
        run: |
          npm install
          npm run build

      # 4Ô∏è‚É£ –î–µ–ø–ª–æ–π –Ω–∞ cPanel —á–µ—Ä–µ–∑ SSH
      - name: üöÄ Deploy via SSH (rsync)
        uses: appleboy/ssh-action@v0.1.9
        with:
          host: ${{ secrets.CPANEL_HOST }}
          username: ${{ secrets.CPANEL_USER }}
          key: ${{ secrets.CPANEL_SSH_KEY }}
          port: 22
          script: |
            # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            mkdir -p /home/ducktimero/public_html/
            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ rsync
            rsync -avz --delete -e "ssh -p 22" ./dist/ ${{ secrets.CPANEL_USER }}@${{ secrets.CPANEL_HOST }}:/home/ducktimero/public_html/
